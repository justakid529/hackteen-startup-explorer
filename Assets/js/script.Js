document.addEventListener("DOMContentLoaded", () => {
  // ================= FORMULÃRIO GERAL =================
  document.getElementById("serviceForm")?.addEventListener("submit", function (event) {
    event.preventDefault();

    const serviceName = document.getElementById("serviceName").value;
    const serviceLink = document.getElementById("serviceLink").value;

    if (serviceName && serviceLink) {
      const serviceCard = `
        <div class="service-card">
          <h3>${serviceName}</h3>
          <a href="${serviceLink}" target="_blank">Acessar</a>
        </div>
      `;
      document.getElementById("servicesList").innerHTML += serviceCard;

      this.reset();
    }
  });

  // ================= FORMULÃRIO YOUTUBE =================
  document.getElementById("youtubeForm")?.addEventListener("submit", function (event) {
    event.preventDefault();

    const videoName = document.getElementById("videoName").value;
    const videoLink = document.getElementById("videoLink").value;

    if (videoName && videoLink) {
      const videoCard = `
        <div class="video-card">
          <h3>${videoName}</h3>
          <iframe src="${converterParaEmbed(videoLink)}" frameborder="0" allowfullscreen></iframe>
        </div>
      `;
      document.getElementById("youtubeList").innerHTML += videoCard;

      this.reset();
    }
  });

  // ================= FUNÃ‡ÃƒO CARREGAR SERVIÃ‡OS =================
  function carregarServicos(categoria) {
    const servicesList = document.getElementById("servicesList");
    servicesList.innerHTML = "";

    const servicos = {
      estudo: [
        { nome: "Khan Academy", link: "https://pt.khanacademy.org" },
        { nome: "Coursera", link: "https://www.coursera.org" },
      ],
      entretenimento: [
        { nome: "Netflix", link: "https://www.netflix.com" },
        { nome: "YouTube", link: "https://www.youtube.com" },
      ],
    };

    servicos[categoria]?.forEach((s) => {
      servicesList.innerHTML += `
        <div class="service-card">
          <h3>${s.nome}</h3>
          <a href="${s.link}" target="_blank">Acessar</a>
        </div>
      `;
    });
  }

  // ================= FUNÃ‡ÃƒO YOUTUBE EMBED =================
  function converterParaEmbed(link) {
    return link.replace("watch?v=", "embed/");
  }

  // ================= RESET =================
  document.getElementById("resetBtn")?.addEventListener("click", function () {
    document.getElementById("servicesList").innerHTML = "";
    document.getElementById("youtubeList").innerHTML = "";
  });

  // ================= CARREGAR AUTOMÃTICO =================
  const categoria = document.querySelector(".services-title")?.dataset.categoria;
  if (categoria) carregarServicos(categoria);

  // ================= FORMULÃRIO CONTATO =================
  document.getElementById("form-contato")?.addEventListener("submit", function (e) {
    e.preventDefault();
    alert("Mensagem enviada com sucesso!");
    this.reset();
  });

  // ================= AUDIO PLAYER =================
  const playBtn = document.getElementById("playBtn");
  const audio = document.getElementById("myAudio");
  playBtn?.addEventListener("click", () => {
    if (audio.paused) audio.play();
    else audio.pause();
  });

  // ================= POPUP DE ESTUDO =================
  const studyPopup = document.getElementById("studyPopup");
  const resultadoPopup = document.getElementById("resultadoPopup");

  window.toggleStudyPopup = function () {
    studyPopup.classList.toggle("show");
  };

  const recomendacoesPopup = {
    matematica: {
      basico: "ğŸ“ Estude FraÃ§Ãµes e Porcentagem.",
      intermediario: "ğŸ“Š Explore EquaÃ§Ãµes e FunÃ§Ãµes.",
      avancado: "ğŸ“ˆ Aprenda Logaritmos e Trigonometria."
    },
    portugues: {
      basico: "ğŸ“– Revise Ortografia e PontuaÃ§Ã£o.",
      intermediario: "ğŸ“ Pratique InterpretaÃ§Ã£o de Texto.",
      avancado: "ğŸ“š Estude Figuras de Linguagem e RedaÃ§Ã£o."
    },
    historia: {
      basico: "ğŸ° ConheÃ§a CivilizaÃ§Ãµes Antigas.",
      intermediario: "âš”ï¸ Estude Idade MÃ©dia e Moderna.",
      avancado: "ğŸ•Šï¸ Guerras Mundiais e Brasil ContemporÃ¢neo."
    },
    geografia: {
      basico: "ğŸ—ºï¸ Aprenda sobre Relevo e Clima.",
      intermediario: "ğŸŒ Estude PopulaÃ§Ã£o e Economia.",
      avancado: "ğŸŒ Explore GeopolÃ­tica e GlobalizaÃ§Ã£o."
    },
    ciencias: {
      basico: "ğŸ”¬ ConheÃ§a os Estados da MatÃ©ria.",
      intermediario: "ğŸŒ¡ï¸ Energia e TransformaÃ§Ãµes.",
      avancado: "ğŸ§ª GenÃ©tica e Ecossistemas."
    },
    fisica: {
      basico: "âš™ï¸ Estude Movimento e ForÃ§a.",
      intermediario: "ğŸ”‹ Energia e Trabalho.",
      avancado: "ğŸŒŒ Eletromagnetismo e Relatividade."
    },
    quimica: {
      basico: "ğŸ§« Tabela PeriÃ³dica e SubstÃ¢ncias.",
      intermediario: "âš—ï¸ LigaÃ§Ãµes QuÃ­micas.",
      avancado: "ğŸ§ª ReaÃ§Ãµes OrgÃ¢nicas e EquilÃ­brio."
    },
    biologia: {
      basico: "ğŸŒ± Estude CÃ©lulas e Seres Vivos.",
      intermediario: "ğŸ§¬ GenÃ©tica e ReproduÃ§Ã£o.",
      avancado: "ğŸŒ EvoluÃ§Ã£o e Biotecnologia."
    },
    sociologia: {
      basico: "ğŸ‘¥ Cultura e Sociedade.",
      intermediario: "ğŸ“Š EstratificaÃ§Ã£o Social.",
      avancado: "ğŸ§  Teorias SociolÃ³gicas."
    },
    filosofia: {
      basico: "ğŸ’­ Ã‰tica e Moral.",
      intermediario: "ğŸ“š Pensadores ClÃ¡ssicos.",
      avancado: "ğŸ§  Epistemologia e Existencialismo."
    },
    ingles: {
      basico: "ğŸ”¤ VocabulÃ¡rio BÃ¡sico.",
      intermediario: "ğŸ—£ï¸ GramÃ¡tica e ConversaÃ§Ã£o.",
      avancado: "ğŸ“˜ Textos LiterÃ¡rios e TraduÃ§Ã£o."
    },
    educacao: {
      basico: "ğŸƒâ€â™‚ï¸ BenefÃ­cios da Atividade FÃ­sica.",
      intermediario: "ğŸ¤¸â€â™€ï¸ Esportes e Condicionamento.",
      avancado: "ğŸ’ª Fisiologia e Treinamento."
    },
    artes: {
      basico: "ğŸ¨ Cores e Formas.",
      intermediario: "ğŸ–Œï¸ HistÃ³ria da Arte.",
      avancado: "ğŸ­ Estilos e ExpressÃµes ArtÃ­sticas."
    }
  };

  window.gerarRecomendacaoPopup = function () {
    const materia = document.getElementById("materiaPopup").value;
    const nivel = document.getElementById("nivelPopup").value;

    if (!materia || !nivel) {
      resultadoPopup.innerHTML = "âš ï¸ Por favor, selecione a matÃ©ria e o nÃ­vel.";
      resultadoPopup.style.display = "block";
      return;
    }

    resultadoPopup.innerHTML = recomendacoesPopup[materia][nivel];
    resultadoPopup.style.display = "block";
  };
});
